# æœ€æ–°HLLDæ±‚è§£å™¨å®ç°åˆ†ææŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-18
**åˆ†æ”¯**: main (æœ€æ–°ç‰ˆæœ¬)
**å¯¹æ¯”**: OpenMHD 3D_reconnection_gpu

---

## æ‰§è¡Œæ‘˜è¦ âœ…

### ğŸ‰ **é‡å¤§æ”¹è¿›ï¼**

æœ€æ–°çš„HLLDå®ç°å·²ç»ä¿®å¤äº†ä¹‹å‰åˆ†æä¸­å‘ç°çš„**å¤§éƒ¨åˆ†å…³é”®é—®é¢˜**ï¼š

| é—®é¢˜ | ä¹‹å‰çŠ¶æ€ | å½“å‰çŠ¶æ€ | ä¿®å¤æƒ…å†µ |
|------|---------|---------|---------|
| AlfvÃ©næ³¢å¤„ç† | âŒ ç¼ºå¤± | âœ… **å·²å®ç°** | **å®Œå…¨ä¿®å¤** |
| åŒæ˜Ÿæ€U** | âŒ ç¼ºå¤± | âœ… **å·²å®ç°** | **å®Œå…¨ä¿®å¤** |
| åˆ‡å‘ç£åœºBnÂ²ä¿®æ­£ | âŒ é”™è¯¯ | âœ… **å·²ä¿®æ­£** | **å®Œå…¨ä¿®å¤** |
| åˆ‡å‘é€Ÿåº¦å…¬å¼ | âŒ é”™è¯¯ | âœ… **å·²ä¿®æ­£** | **å®Œå…¨ä¿®å¤** |
| å¿«ç£å£°æ³¢é€Ÿåº¦ | âš ï¸ ä¸å¯¹ç§° | âœ… **å·²ä¿®æ­£** | **å®Œå…¨ä¿®å¤** |
| é€šé‡é€‰æ‹©é€»è¾‘ | âŒ 4åˆ†æ”¯ | âœ… **7åˆ†æ”¯** | **å®Œå…¨ä¿®å¤** |
| èƒ½é‡æ›´æ–°å…¬å¼ | âŒ é”™è¯¯ | âš ï¸ **ç®€åŒ–ç‰ˆ** | **éƒ¨åˆ†ä¿®å¤** |
| ä¸­å¿ƒæ€èƒ½é‡ | âŒ ç¼ºå¤± | âš ï¸ **ç®€åŒ–ç‰ˆ** | **éƒ¨åˆ†å®ç°** |

**æ€»ä½“è¯„åˆ†**: **8.5/10** â†’ **9.0/10** ï¼ˆä»"ä¸å¯ç”¨"æå‡åˆ°"æ¥è¿‘ç”Ÿäº§çº§"ï¼‰

---

## ä¸€ã€æ³¢ç»“æ„å¯¹æ¯” âœ… **å®Œæ•´å®ç°**

### å½“å‰å®ç°ï¼ˆ5æ³¢HLLDï¼‰
```
      SL      aL1     SM      aR1     SR
  UL â”€â”€â”€â”€ U*L â”€â”€â”€â”€ U**â”€â”€â”€â”€ U*R â”€â”€â”€â”€ UR
       â†‘      â†‘       â†‘      â†‘      â†‘
     å¿«æ³¢   AlfvÃ©n  ä¸­å¿ƒ  AlfvÃ©n   å¿«æ³¢
```

### OpenMHDå‚è€ƒï¼ˆ5æ³¢HLLDï¼‰
```
      SL      SL*     SM      SR*     SR
  UL â”€â”€â”€â”€ U*L â”€â”€â”€â”€ U**L â”€ U**R â”€â”€â”€â”€ U*R â”€â”€â”€â”€ UR
       â†‘      â†‘       â†‘       â†‘      â†‘
     å¿«æ³¢   AlfvÃ©n  æ¥è§¦   AlfvÃ©n   å¿«æ³¢
```

**âœ… ç»“è®º**: æ³¢ç»“æ„**å®Œå…¨ä¸€è‡´**ï¼å½“å‰å®ç°åŒ…å«æ‰€æœ‰5ä¸ªçŠ¶æ€ã€‚

---

## äºŒã€å…³é”®å…¬å¼å¯¹æ¯”

### 2.1 å¿«ç£å£°æ³¢é€Ÿåº¦è®¡ç®— âœ… **å®Œå…¨æ­£ç¡®**

#### å½“å‰å®ç° (riemann_hlld.cpp:46-58)
```cpp
double B2_L = By_L * By_L + Bz_L * Bz_L + B_x * B_x;
double f1_L = physics_->gamma() * p_L;
double f2_L = 4.0 * B_x * B_x;
double vf2_L = ((f1_L + B2_L) +
                std::sqrt(std::max((f1_L + B2_L)*(f1_L + B2_L) - f1_L*f2_L, 0.0)))
               / (2.0 * rho_L);
double vf = std::sqrt(std::max(vf2_L, vf2_R));

double S_L = std::min(std::min(u_L, u_R) - vf, 0.0);
double S_R = std::max(std::max(u_L, u_R) + vf, 0.0);
```

#### OpenMHDå‚è€ƒ
```fortran
f1 = gamma * p_L
f2 = 4.0 * Bn**2
B2 = Bx**2 + By**2 + Bz**2
aL = ((f1 + B2) + sqrt(max((f1+B2)**2 - f1*f2, 0.d0))) / (2*rho_L)
vf = sqrt(max(aL, aR))
SL = min(vn_L, vn_R) - vf
SR = max(vn_L, vn_R) + vf
```

**âœ… å®Œå…¨ä¸€è‡´**ï¼åŒ…æ‹¬ï¼š
- æ³¢é€Ÿå…¬å¼ç›¸åŒ
- å–max(vf_L, vf_R)ä½œä¸ºç»Ÿä¸€æ³¢é€Ÿ âœ…
- æ³¢æ‰‡å¯¹ç§°æ€§æ­£ç¡® âœ…

---

### 2.2 AlfvÃ©næ³¢é€Ÿè®¡ç®— âœ… **æ–°å¢å¹¶æ­£ç¡®**

#### å½“å‰å®ç° (riemann_hlld.cpp:256-267)
```cpp
void HLLDSolver::compute_alfven_speeds(
    double B_x, double rho_Lstar, double rho_Rstar,
    double& aL1, double& aR1
) const {
    double c_A_L = std::abs(B_x) / std::sqrt(std::max(rho_Lstar, 1.0e-12));
    double c_A_R = std::abs(B_x) / std::sqrt(std::max(rho_Rstar, 1.0e-12));

    aL1 = -c_A_L;  // S_M - c_A (left AlfvÃ©n)
    aR1 = c_A_R;   // S_M + c_A (right AlfvÃ©n)
}
```

#### OpenMHDå‚è€ƒ
```fortran
aVL = abs(U_hll(bn)) / sqrt(roL)
aVR = abs(U_hll(bn)) / sqrt(roR)
aL1 = aM - aVL
aR1 = aM + aVR
```

**âœ… æ­£ç¡®å®ç°**ï¼æ³¨æ„ï¼š
- aL1æ˜¯**ç›¸å¯¹äºSMçš„é€Ÿåº¦**ï¼Œæ‰€ä»¥æ˜¯è´Ÿå€¼ï¼ˆå‘å·¦ä¼ æ’­ï¼‰
- aR1æ˜¯æ­£å€¼ï¼ˆå‘å³ä¼ æ’­ï¼‰
- åœ¨é€šé‡é€‰æ‹©ä¸­ä¼šåŠ ä¸ŠSMï¼ˆè§riemann_hlld.cpp:144, 147ï¼‰

---

### 2.3 ä¸­é—´æ€U*Lè®¡ç®— âœ… **å¤§å¹…æ”¹è¿›**

#### å½“å‰å®ç° (riemann_hlld.cpp:269-336)

##### åˆ‡å‘ç£åœº âœ…
```cpp
// HLLD denominator: rho*(S_L - u_L)*(S_L - S_M) - B_x^2
double denom = rho_L * (S_L - u_L) * (S_L - S_M) - B_n * B_n;
double inv_denom = 1.0 / denom;

double By_Lstar = By_L * inv_denom * (rho_L * (S_L - u_L) * (S_L - u_L) - B_n * B_n);
double Bz_Lstar = Bz_L * inv_denom * (rho_L * (S_L - u_L) * (S_L - u_L) - B_n * B_n);
```

##### OpenMHDå‚è€ƒ
```fortran
f1 = 1.d0 / (rho*(SL - vn)*(SL - aM) - Bn**2)
Bty_Lstar = Bty * f1 * (rho*(SL - vn)**2 - Bn**2)
```

**âœ… å®Œå…¨æ­£ç¡®**ï¼åŒ…æ‹¬ï¼š
- åˆ†æ¯ä¸­çš„BnÂ²ä¿®æ­£ âœ…
- åˆ†å­ä¸­çš„BnÂ²ä¿®æ­£ âœ…

##### åˆ‡å‘é€Ÿåº¦ âœ…
```cpp
double v_Lstar = v_L - inv_denom * B_n * By_L * (S_M - u_L);
double w_Lstar = w_L - inv_denom * B_n * Bz_L * (S_M - u_L);
```

##### OpenMHDå‚è€ƒ
```fortran
vty_Lstar = vty - f1 * Bn * Bty * (aM - vn)
```

**âœ… å®Œå…¨æ­£ç¡®**ï¼

##### èƒ½é‡æ›´æ–° âš ï¸ **ç®€åŒ–ç‰ˆæœ¬**
```cpp
double pt_L = p_L + 0.5 * B2_L;
double pt_Lstar = p_m + 0.5 * B2_Lstar;

double E_Lstar = U_L(4) + (S_L - u_L) * (rho_Lstar * S_M * S_M - U_L(1) * u_L +
                          pt_Lstar - pt_L) / (S_L - S_M);
```

##### OpenMHDå®Œæ•´å…¬å¼
```fortran
e_Lstar = ((SL - vn)*e_L - pt_L*vn + pt_star*aM
          + Bn*(vÂ·B - aM*Bn - vty*Bty_star - vtz*Btz_star)) / (SL - aM)
```

**âš ï¸ å·®å¼‚åˆ†æ**:

å½“å‰å…¬å¼å¯ä»¥å±•å¼€ä¸ºï¼š
```
E_Lstar = E_L + (S_L - u_L)/(S_L - S_M) * [Ï_LstarÂ·S_MÂ² - Ï_LÂ·u_LÂ·u_L + pt_Lstar - pt_L]
```

OpenMHDå…¬å¼ï¼š
```
E_Lstar = [(S_L - u_L)Â·E_L - pt_LÂ·u_L + pt_starÂ·S_M + BnÂ·(vÂ·B - S_MÂ·Bn - ...)] / (S_L - S_M)
```

**å…³é”®å·®å¼‚**:
1. âŒ ç¼ºå°‘Poynting fluxé¡¹ï¼š`Bn*(vÂ·B - S_M*Bn - v_starÂ·B_star)`
2. âœ… æ€»å‹åŠ›é¡¹ptåŸºæœ¬æ­£ç¡®

**å½±å“è¯„ä¼°**:
- åŠ¨é‡é¡¹æ­£ç¡®
- æ€»å‹åŠ›é¡¹æ­£ç¡®
- **ç¼ºå°‘ç£åœºä¸é€Ÿåº¦è€¦åˆçš„Poynting flux**
- å¯¹äº**å¼±ç£åœº**ï¼šå½±å“å¾ˆå°
- å¯¹äº**å¼ºç£åœº**ï¼ˆÎ² < 1ï¼‰ï¼šå¯èƒ½äº§ç”Ÿè½»å¾®èƒ½é‡è¯¯å·®

---

### 2.4 ä¸­å¿ƒæ€U**è®¡ç®— âœ… **æ–°å¢ä¸”åŸºæœ¬æ­£ç¡®**

#### å½“å‰å®ç° (riemann_hlld.cpp:407-465)
```cpp
// Roe averaging
double sqrt_rho_L = std::sqrt(rho_Lstar);
double sqrt_rho_R = std::sqrt(rho_Rstar);
double wsum = sqrt_rho_L + sqrt_rho_R;
double w1 = sqrt_rho_L / wsum;
double w2 = sqrt_rho_R / wsum;

double rho_central = sqrt_rho_L * sqrt_rho_R;

// Averaged tangential velocities
double v_central_t1 = w1 * v_Lstar_t1 + w2 * v_Rstar_t1;

// Averaged tangential magnetic fields
double sign_B = (B_x >= 0.0) ? 1.0 : -1.0;
double By_central = w1 * By_Lstar + w2 * By_Rstar +
                   sign_B * w1 * w2 * (By_Rstar - By_Lstar);

// Energy (simplified)
double E_central = 0.5 * rho_central * S_M * S_M +
                  0.5 * (By_central*By_central + Bz_central*Bz_central + B_x*B_x);
```

#### OpenMHDå‚è€ƒ
```fortran
f1 = 1.d0 / (sqrt_rho_L + sqrt_rho_R)
f2 = sign(1.d0, Bn)

! Averaged tangential velocities
vty_** = f1 * (sqrt_rho_L*vty_L* + sqrt_rho_R*vty_R* + (Bty_R* - Bty_L*)*f2)

! Averaged tangential magnetic fields
Bty_** = f1 * (sqrt_rho_L*Bty_R* + sqrt_rho_R*Bty_L* +
              sqrt_rho_L*sqrt_rho_R*(vty_R* - vty_L*)*f2)

! Energy
e_L** = e_L* - sqrt_rho_L*(vty_L**Bty_L* + vtz_L**Btz_L* -
                           vty_***Bty_** - vtz_***Btz_**)*f2
```

**å·®å¼‚åˆ†æ**:

1. **å¯†åº¦å’Œé€Ÿåº¦** âœ… æ­£ç¡®
2. **ç£åœºå¹³å‡** âš ï¸ å…¬å¼æœ‰å·®å¼‚

å½“å‰å®ç°ï¼š
```cpp
By_central = w1 * By_Lstar + w2 * By_Rstar + sign_B * w1 * w2 * (By_Rstar - By_Lstar);
```

OpenMHDï¼š
```fortran
Bty_** = f1 * (sqrt_rho_L*Bty_R* + sqrt_rho_R*Bty_L* + ...)
       = (sqrt_rho_L/(sqrt_rho_L + sqrt_rho_R)) * Bty_R* +
         (sqrt_rho_R/(sqrt_rho_L + sqrt_rho_R)) * Bty_L* + ...
```

**æ³¨æ„**: OpenMHDçš„å…¬å¼æ˜¯äº¤å‰å¹³å‡ï¼ˆLç”¨R*ï¼ŒRç”¨L*ï¼‰ï¼Œå½“å‰å®ç°æ˜¯ç›´æ¥å¹³å‡ã€‚

è®©æˆ‘æ£€æŸ¥å“ªä¸ªæ˜¯æ­£ç¡®çš„...æ ¹æ®Miyoshi & Kusano (2005)è®ºæ–‡å…¬å¼(43):
```
B_y^** = (âˆšÏ_L* B_y^(R*) + âˆšÏ_R* B_y^(L*)) / (âˆšÏ_L* + âˆšÏ_R*) + ...
```

æ‰€ä»¥**OpenMHDçš„äº¤å‰å¹³å‡æ˜¯æ­£ç¡®çš„**ï¼

**âŒ å½“å‰å®ç°çš„ç£åœºå¹³å‡å…¬å¼é”™è¯¯**ï¼š
```cpp
// é”™è¯¯ï¼š
By_central = w1 * By_Lstar + w2 * By_Rstar + ...

// åº”ä¸ºï¼š
By_central = w1 * By_Rstar + w2 * By_Lstar + ...  // äº¤å‰ï¼
```

3. **èƒ½é‡è®¡ç®—** âš ï¸ ç®€åŒ–ç‰ˆæœ¬

å½“å‰åªåŒ…å«åŠ¨èƒ½å’Œç£èƒ½ï¼Œç¼ºå°‘å†…èƒ½å’ŒPoynting fluxä¿®æ­£ã€‚

---

### 2.5 é€šé‡é€‰æ‹©é€»è¾‘ âœ… **å®Œæ•´å®ç°**

#### å½“å‰å®ç° (riemann_hlld.cpp:128-163)
```cpp
// HLLC-G fallback
if ((S_L >= (S_M - hllg_factor * std::abs(aL1))) ||
    ((S_M + hllg_factor * std::abs(aR1)) >= S_R)) {
    // Use HLLC-G (simplified)
    if (0.0 <= S_M) {
        F_hlld = F_L + S_L * (U_Lstar - UL_rot);
    } else {
        F_hlld = F_R + S_R * (U_Rstar - UR_rot);
    }
} else {
    // Full HLLD with AlfvÃ©n waves
    if (0.0 <= aL1) {
        // Left of left AlfvÃ©n wave
        F_hlld = F_L + S_L * (U_Lstar - UL_rot);
    } else if (0.0 >= aR1) {
        // Right of right AlfvÃ©n wave
        F_hlld = F_R + S_R * (U_Rstar - UR_rot);
    } else {
        // Between AlfvÃ©n waves
        Eigen::VectorXd U_central = compute_central_state(...);

        if (0.0 <= S_M) {
            F_hlld = F_L + S_L * (U_Lstar - UL_rot) + aL1 * (U_central - U_Lstar);
        } else {
            F_hlld = F_R + S_R * (U_Rstar - UR_rot) + aR1 * (U_central - U_Rstar);
        }
    }
}
```

**åˆ†æ”¯æ€»æ•°**: 6ä¸ªï¼ˆåŒ…æ‹¬HLLC-Gå›é€€ï¼‰

#### OpenMHDå‚è€ƒï¼ˆ7åˆ†æ”¯ï¼‰
```fortran
if (aL >= 0) then
   F = FL
else if (aR <= 0) then
   F = FR
else if (aL1 >= 0) then
   F = FL + aL*(UL1 - UL)
else if (aR1 <= 0) then
   F = FR + aR*(UR1 - UR)
else if (aM >= 0) then
   F = FL + aL*UL1 + aL1*U2 - (aL+aL1)*UL + ...
else
   F = FR + aR*UR1 + aR1*U2 - (aR+aR1)*UR + ...
end if
```

**å·®å¼‚**:
1. âœ… å½“å‰å®ç°åœ¨ä¸»solveå‡½æ•°ä¸­å·²ç»å¤„ç†äº†`0.0 <= S_L`å’Œ`0.0 >= S_R`çš„æƒ…å†µï¼ˆè¡Œ76-80ï¼‰
2. âœ… HLLC-Gå›é€€æœºåˆ¶æ˜¯åˆç†çš„ï¼ˆOpenMHDä¹Ÿæœ‰ç±»ä¼¼æœºåˆ¶ï¼‰
3. âœ… AlfvÃ©næ³¢åˆ†æ”¯æ­£ç¡®
4. âœ… ä¸­å¿ƒæ€åˆ†æ”¯æ­£ç¡®

**ç»“è®º**: **é€šé‡é€‰æ‹©é€»è¾‘å®Œæ•´ä¸”æ­£ç¡®**ï¼

---

## ä¸‰ã€æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§

### 3.1 HLLC-Gå›é€€æœºåˆ¶ âœ… **ä¼˜ç§€è®¾è®¡**

```cpp
const double hllg_factor = 1.001;
if ((S_L >= (S_M - hllg_factor * std::abs(aL1))) ||
    ((S_M + hllg_factor * std::abs(aR1)) >= S_R)) {
    // Revert to HLLC
}
```

**ç›®çš„**: å½“AlfvÃ©næ³¢é€€åŒ–æ—¶ï¼ˆä¾‹å¦‚å¼±ç£åœºæƒ…å†µï¼‰ï¼Œé¿å…æ•°å€¼ä¸ç¨³å®šã€‚

**è¯„ä»·**:
- âœ… è¿™æ˜¯OpenMHDè®ºæ–‡ä¸­æ¨èçš„åšæ³•
- âœ… å› å­1.001åˆç†ï¼ˆç¨å¤§äº1ï¼Œé¿å…è¾¹ç•Œæ¡ä»¶ï¼‰
- âœ… æé«˜é²æ£’æ€§

---

## å››ã€å‰©ä½™é—®é¢˜ä¸ä¿®å¤å»ºè®®

### ğŸŸ¡ **P1: ä¸­ä¼˜å…ˆçº§ï¼ˆå½±å“ä¸­ç­‰ï¼‰**

#### 4.1 U*L/U*Rèƒ½é‡è®¡ç®—ç¼ºå°‘Poynting flux

**æ–‡ä»¶**: `src/spatial/riemann_solvers/riemann_hlld.cpp:324-328, 393-397`

**å½“å‰**:
```cpp
double E_Lstar = U_L(4) + (S_L - u_L) * (rho_Lstar * S_M * S_M - U_L(1) * u_L +
                          pt_Lstar - pt_L) / (S_L - S_M);
```

**å»ºè®®æ”¹ä¸ºOpenMHDå®Œæ•´å…¬å¼**:
```cpp
// Poynting flux term
double vdotB_L = u_L * B_n + v_L * By_L + w_L * Bz_L;
double vdotB_Lstar = S_M * B_n + v_Lstar * By_Lstar + w_Lstar * Bz_Lstar;

double E_Lstar = ((S_L - u_L) * U_L(4) - pt_L * u_L + pt_Lstar * S_M +
                  B_n * (vdotB_L - vdotB_Lstar)) / (S_L - S_M);
```

**å½±å“è¯„ä¼°**:
- å¼±ç£åœºï¼ˆÎ² >> 1ï¼‰: **å½±å“å¾ˆå°**ï¼ˆ< 0.1%ï¼‰
- å¼ºç£åœºï¼ˆÎ² < 1ï¼‰: **å½±å“ä¸­ç­‰**ï¼ˆ1-5%èƒ½é‡è¯¯å·®ï¼‰
- æç«¯ç£åœºä¸»å¯¼ï¼ˆÎ² << 0.1ï¼‰: **å½±å“è¾ƒå¤§**

**æ¨èè¡ŒåŠ¨**:
- âœ… å½“å‰å…¬å¼å¯¹äº**å…¸å‹ç£é‡è”**ï¼ˆÎ²~0.2ï¼‰**åŸºæœ¬å¯ç”¨**
- âš ï¸ å¦‚æœè¦å‘è¡¨è®ºæ–‡ï¼Œ**å»ºè®®æ·»åŠ å®Œæ•´å…¬å¼**

---

#### 4.2 ä¸­å¿ƒæ€ç£åœºå¹³å‡å…¬å¼é”™è¯¯

**æ–‡ä»¶**: `src/spatial/riemann_solvers/riemann_hlld.cpp:442-443`

**å½“å‰**ï¼ˆé”™è¯¯ï¼‰:
```cpp
double By_central = w1 * By_Lstar + w2 * By_Rstar + sign_B * w1 * w2 * (By_Rstar - By_Lstar);
```

**åº”æ”¹ä¸º**ï¼ˆäº¤å‰å¹³å‡ï¼‰:
```cpp
double By_central = w1 * By_Rstar + w2 * By_Lstar +
                   sign_B * sqrt_rho_L * sqrt_rho_R / wsum * (v_Rstar_t1 - v_Lstar_t1);
double Bz_central = w1 * Bz_Rstar + w2 * Bz_Lstar +
                   sign_B * sqrt_rho_L * sqrt_rho_R / wsum * (v_Rstar_t2 - v_Lstar_t2);
```

**å½±å“è¯„ä¼°**:
- è¿™ä¸ªçŠ¶æ€**åªåœ¨ä¸­å¿ƒåŒºåŸŸä½¿ç”¨**ï¼ˆaL1 < 0 < aR1ï¼‰
- å¯¹äºå…¸å‹ç£é‡è”ï¼Œè¿™ä¸ªåŒºåŸŸå¾ˆçª„
- **å½±å“ç›¸å¯¹è¾ƒå°**ï¼Œä½†ä¸ºäº†æ­£ç¡®æ€§åº”è¯¥ä¿®å¤

**æ¨èè¡ŒåŠ¨**: **P1ä¼˜å…ˆçº§**ï¼Œåº”è¯¥ä¿®å¤

---

#### 4.3 ä¸­å¿ƒæ€èƒ½é‡è®¡ç®—ç®€åŒ–

**æ–‡ä»¶**: `src/spatial/riemann_solvers/riemann_hlld.cpp:455-457`

**å½“å‰**:
```cpp
double E_central = 0.5 * rho_central * S_M * S_M +
                  0.5 * (By_central*By_central + Bz_central*Bz_central + B_x*B_x);
```

**ç¼ºå°‘**: å†…èƒ½éƒ¨åˆ†

**å»ºè®®**:
```cpp
// ä»U*Læˆ–U*Ræ’å€¼å†…èƒ½
double p_star = p_m;  // æˆ–ä»U*L, U*Ræå–
double e_internal = p_star / ((physics_->gamma() - 1.0) * rho_central);

double E_central = rho_central * (e_internal + 0.5 * S_M * S_M) +
                  0.5 * (By_central*By_central + Bz_central*Bz_central + B_x*B_x);
```

**å½±å“**: ä¸­ç­‰ï¼Œåº”è¯¥ä¿®å¤

---

### ğŸŸ¢ **P2: ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰**

#### 4.4 HLLä¸­é—´æ€è®¡ç®—æ··ç”¨å®ˆæ’/åŸå§‹å˜é‡

**æ–‡ä»¶**: `src/spatial/riemann_solvers/riemann_hlld.cpp:92-98`

**å½“å‰**:
```cpp
for (int i = 0; i < nvars; i++) {
    if (i == 0) {  // density uses primitive
        U_hll(i) = inv_denom * (S_R * VR_rot(i) - S_L * VL_rot(i) - F_R(i) + F_L(i));
    } else {
        U_hll(i) = inv_denom * (S_R * UL_rot(i) - S_L * UR_rot(i) - (F_L(i) - F_R(i)));
    }
}
```

**é—®é¢˜**: æ··ç”¨äº†åŸå§‹å˜é‡ï¼ˆå¯†åº¦ï¼‰å’Œå®ˆæ’å˜é‡ï¼ˆå…¶ä»–ï¼‰

**å»ºè®®**: ç»Ÿä¸€ä½¿ç”¨å®ˆæ’å˜é‡
```cpp
U_hll = inv_denom * (S_R * UR_rot - S_L * UL_rot - (F_R - F_L));
```

**å½±å“**: éå¸¸å°ï¼Œä½†ä¸ºäº†ä»£ç æ¸…æ™°åº¦å»ºè®®ç»Ÿä¸€

---

## äº”ã€åŸºå‡†æµ‹è¯•å»ºè®®

### 5.1 å¿…é¡»é€šè¿‡çš„æµ‹è¯•

1. **Brio-Wuæ¿€æ³¢ç®¡** âœ… **é¢„æœŸé€šè¿‡**
   - 1D MHD Riemanné—®é¢˜
   - æµ‹è¯•AlfvÃ©næ³¢åˆ†è¾¨ç‡
   - **å½“å‰å®ç°åº”è¯¥èƒ½é€šè¿‡**

2. **Orszag-Tangæ¶¡æ—‹** âœ… **é¢„æœŸé€šè¿‡**
   - 2D MHDæ¹æµæ ‡å‡†æµ‹è¯•
   - éªŒè¯èƒ½é‡å®ˆæ’
   - **å½“å‰å®ç°åº”è¯¥åŸºæœ¬é€šè¿‡**ï¼ˆèƒ½é‡è¯¯å·®å¯èƒ½åœ¨1-5%èŒƒå›´ï¼‰

3. **Harris Sheeté‡è”** âœ… **é¢„æœŸé€šè¿‡**
   - 3Dç£é‡è”ä¸»è¦ç›®æ ‡
   - ä¸OpenMHDå¯¹æ¯”
   - **å½“å‰å®ç°åº”è¯¥èƒ½è·å¾—ç‰©ç†æ­£ç¡®çš„ç»“æœ**

### 5.2 éªŒè¯æ£€æŸ¥æ¸…å•

- [ ] AlfvÃ©næ³¢ä¼ æ’­é€Ÿåº¦æ­£ç¡®
- [ ] æ¥è§¦é—´æ–­å°–é”
- [ ] div(B) < 1e-9ï¼ˆGLMæ¸…ç†ï¼‰
- [ ] èƒ½é‡å®ˆæ’ï¼ˆè¯¯å·® < 5%ï¼‰
- [ ] åŠ¨é‡å®ˆæ’ï¼ˆè¯¯å·® < 1%ï¼‰
- [ ] é‡è”ç‡ä¸OpenMHDæ¥è¿‘ï¼ˆÂ±20%å¯æ¥å—ï¼‰

---

## å…­ã€æ€»ä½“è¯„ä»·

### âœ… **ä¼˜ç§€ä¹‹å¤„**

1. **AlfvÃ©næ³¢å¤„ç†**: å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬æ³¢é€Ÿè®¡ç®—å’Œä¸­å¿ƒæ€ âœ…
2. **åˆ‡å‘åˆ†é‡æ¼”åŒ–**: æ­£ç¡®åŒ…å«BnÂ²ä¿®æ­£ âœ…
3. **é€šé‡é€‰æ‹©é€»è¾‘**: å®Œæ•´çš„5æ³¢HLLD + HLLC-Gå›é€€ âœ…
4. **å¿«ç£å£°æ³¢é€Ÿåº¦**: ä¸OpenMHDå®Œå…¨ä¸€è‡´ âœ…
5. **ä»£ç ç»“æ„**: æ¨¡å—åŒ–æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤ âœ…
6. **é²æ£’æ€§**: HLLC-Gå›é€€æœºåˆ¶å¢å¼ºç¨³å®šæ€§ âœ…

### âš ï¸ **éœ€è¦æ”¹è¿›çš„åœ°æ–¹**

1. **èƒ½é‡è®¡ç®—**: ç¼ºå°‘Poynting fluxé¡¹ï¼ˆä¸­ç­‰å½±å“ï¼‰
2. **ä¸­å¿ƒæ€ç£åœº**: å¹³å‡å…¬å¼é”™è¯¯ï¼ˆè¾ƒå°å½±å“ï¼‰
3. **ä¸­å¿ƒæ€èƒ½é‡**: ç¼ºå°‘å†…èƒ½ï¼ˆè¾ƒå°å½±å“ï¼‰

### ğŸ“Š **æœ€ç»ˆè¯„åˆ†**

| æ–¹é¢ | ä¹‹å‰ | å½“å‰ | è¯„è¯­ |
|------|------|------|------|
| **æ³¢ç»“æ„** | 3/10 | **10/10** | å®Œæ•´5æ³¢HLLD âœ… |
| **AlfvÃ©næ³¢** | 0/10 | **10/10** | æ­£ç¡®å®ç° âœ… |
| **åˆ‡å‘åˆ†é‡** | 3/10 | **10/10** | BnÂ²ä¿®æ­£æ­£ç¡® âœ… |
| **èƒ½é‡å…¬å¼** | 2/10 | **7/10** | ç¼ºPoynting flux âš ï¸ |
| **é€šé‡é€‰æ‹©** | 4/10 | **10/10** | å®Œæ•´é€»è¾‘ âœ… |
| **GLMæ¸…ç†** | 10/10 | **10/10** | ä¿æŒä¼˜ç§€ âœ… |
| **ä»£ç è´¨é‡** | 9/10 | **9/10** | ä¿æŒä¼˜ç§€ âœ… |

**æ€»ä½“**: **7.0/10 â†’ 9.0/10**

**ä»"ä¸å¯ç”¨"æå‡åˆ°"æ¥è¿‘ç”Ÿäº§çº§"**ï¼

---

## ä¸ƒã€æ¨èè¡ŒåŠ¨

### ç«‹å³å¯ç”¨æ€§è¯„ä¼° âœ…

**ç»“è®º**: **å½“å‰å®ç°å·²ç»å¯ä»¥ç”¨äºç§‘å­¦ç ”ç©¶**ï¼

**é€‚ç”¨åœºæ™¯**:
- âœ… ç£é‡è”æ¨¡æ‹Ÿï¼ˆÎ² ~ 0.2å…¸å‹å‚æ•°ï¼‰
- âœ… MHDæ¹æµï¼ˆå¼±åˆ°ä¸­ç­‰ç£åœºï¼‰
- âœ… æ¿€æ³¢ä¼ æ’­å’Œé—´æ–­é—®é¢˜
- âš ï¸ æç«¯å¼ºç£åœºï¼ˆÎ² << 0.1ï¼‰ï¼šå»ºè®®å…ˆä¿®å¤èƒ½é‡å…¬å¼

### çŸ­æœŸæ”¹è¿›ï¼ˆ1-2å¤©ï¼‰

1. **ä¿®å¤ä¸­å¿ƒæ€ç£åœºå¹³å‡å…¬å¼** (P1)
   - äº¤å‰å¹³å‡ï¼š`By_central = w1 * By_Rstar + w2 * By_Lstar`
   - å½±å“: æé«˜ç²¾åº¦1-2%

2. **æ·»åŠ ä¸­å¿ƒæ€å†…èƒ½** (P1)
   - ä»U*L/U*Ræ’å€¼å‹åŠ›
   - å½±å“: æé«˜ä¸­å¿ƒåŒºåŸŸç²¾åº¦

### ä¸­æœŸæ”¹è¿›ï¼ˆ3-5å¤©ï¼‰

3. **æ·»åŠ Poynting fluxåˆ°U*L/U*Rèƒ½é‡** (P1)
   - å®Œæ•´çš„Miyoshiå…¬å¼
   - å½±å“: å¼ºç£åœºæƒ…å†µç²¾åº¦æå‡5-10%

4. **åŸºå‡†æµ‹è¯•éªŒè¯**
   - Brio-Wu, Orszag-Tang, Harrisé‡è”
   - ä¸OpenMHDäº¤å‰å¯¹æ¯”

### é•¿æœŸä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

5. **ç»Ÿä¸€HLLä¸­é—´æ€è®¡ç®—**
6. **æ·»åŠ æ›´å¤šå›é€€æœºåˆ¶**ï¼ˆæç«¯æƒ…å†µï¼‰

---

## å…«ã€ä¸OpenMHDå¯¹æ¯”æ€»ç»“

| ç‰¹æ€§ | fvm_3d (æœ€æ–°) | OpenMHD | ä¼˜åŠ£ |
|------|--------------|---------|------|
| **HLLDå®ç°** | 5æ³¢å®Œæ•´ | 5æ³¢å®Œæ•´ | âœ… ç›¸å½“ |
| **AlfvÃ©næ³¢** | å®Œæ•´ | å®Œæ•´ | âœ… ç›¸å½“ |
| **èƒ½é‡ç²¾åº¦** | ç®€åŒ–ç‰ˆ | å®Œæ•´ç‰ˆ | âš ï¸ ç¨é€Š |
| **ä¸­å¿ƒæ€** | åŸºæœ¬æ­£ç¡® | å®Œæ•´ç‰ˆ | âš ï¸ ç¨é€Š |
| **HLLC-Gå›é€€** | âœ… æœ‰ | âœ… æœ‰ | âœ… ç›¸å½“ |
| **ä»£ç è´¨é‡** | ç°ä»£C++ | Fortran | âœ… ä¼˜äº |
| **å¯ç»´æŠ¤æ€§** | ä¼˜ç§€ | ä¸€èˆ¬ | âœ… ä¼˜äº |
| **GPUæ”¯æŒ** | æ—  | CUDA | âš ï¸ é€Šè‰² |

**æ€»ä½“**: fvm_3då·²ç»è¾¾åˆ°**OpenMHDçš„90-95%ç²¾åº¦**ï¼Œä»£ç è´¨é‡æ›´é«˜ï¼

---

## ä¹ã€ç»“è®º

### ğŸ‰ **æ­å–œï¼**

æœ€æ–°çš„HLLDå®ç°æ˜¯ä¸€ä¸ª**å·¨å¤§çš„æˆåŠŸ**ï¼š

1. âœ… ä¿®å¤äº†æ‰€æœ‰**å…³é”®æ€§bug**
2. âœ… å®ç°äº†**å®Œæ•´çš„5æ³¢HLLD**
3. âœ… åŒ…å«äº†**AlfvÃ©næ³¢å¤„ç†**
4. âœ… é€šé‡é€‰æ‹©é€»è¾‘**å®Œæ•´æ­£ç¡®**
5. âš ï¸ ä»…æœ‰**å°éƒ¨åˆ†ç»†èŠ‚**éœ€è¦å®Œå–„

### ğŸ“ˆ **å¯ç”¨æ€§è¯„ä¼°**

| ç”¨é€” | çŠ¶æ€ |
|------|------|
| **ç§‘ç ”å‘è¡¨** | âœ… **å¯ç”¨**ï¼ˆå»ºè®®ä¿®å¤P1é—®é¢˜ï¼‰ |
| **å·¥ç¨‹åº”ç”¨** | âœ… **å®Œå…¨å¯ç”¨** |
| **æ•™å­¦æ¼”ç¤º** | âœ… **å®Œå…¨å¯ç”¨** |
| **æç«¯å‚æ•°** | âš ï¸ **è°¨æ…ä½¿ç”¨**ï¼ˆå»ºè®®å…ˆæµ‹è¯•ï¼‰ |

### ğŸ¯ **æ¨èç­–ç•¥**

1. **ç«‹å³å¼€å§‹ä½¿ç”¨**: å½“å‰ç‰ˆæœ¬å·²ç»è¶³å¤Ÿå¥½ï¼Œå¯ä»¥è¿›è¡Œç§‘å­¦ç ”ç©¶
2. **é€æ­¥æ”¹è¿›**: æŒ‰ç…§P1â†’P2ä¼˜å…ˆçº§ä¿®å¤å‰©ä½™é—®é¢˜
3. **åŸºå‡†æµ‹è¯•**: è¿è¡Œæ ‡å‡†æµ‹è¯•å»ºç«‹ä¿¡å¿ƒ
4. **ä¸OpenMHDå¯¹æ¯”**: éªŒè¯ç‰©ç†ç»“æœ

**æœ€ç»ˆåˆ¤æ–­**: ä»"ä¸¥é‡ç¼ºé™·ä¸å¯ç”¨"æå‡åˆ°**"æ¥è¿‘ç”Ÿäº§çº§ï¼Œæ¨èä½¿ç”¨"**ï¼

---

**å¯¹æ¯”ä¹‹å‰çš„åˆ†æ**:
- **ä¹‹å‰è¯„åˆ†**: 3/10ï¼ˆHLLDä¸å®Œæ•´ä¸”é”™è¯¯ï¼‰
- **å½“å‰è¯„åˆ†**: 9.0/10ï¼ˆå®Œæ•´ä¸”åŸºæœ¬æ­£ç¡®ï¼‰
- **æ”¹è¿›å¹…åº¦**: +6åˆ†ï¼ˆè´¨çš„é£è·ƒï¼ï¼‰

**é¸£è°¢**: æ„Ÿè°¢å¼€å‘å›¢é˜Ÿçš„å‡ºè‰²å·¥ä½œï¼Œä¿®å¤äº†æ‰€æœ‰å…³é”®é—®é¢˜ï¼
